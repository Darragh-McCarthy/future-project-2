
<article style="display:inline-block;" 
    class="fp-prediction"
    ng-class="{'fp-prediction--expanded': ctrl.prediction.isExpanded}">
<!--
<img style="display:inline-block;width:50px;height:50px;border-radius:50px;position:absolute;top:10px;left:-50px;" src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-xat1/v/t1.0-1/p200x200/10410095_10204571738670575_5638321658802120076_n.jpg?oh=58a86fedc0ef7299bfd8fb805ba9b044&oe=560E6791&__gda__=1444015358_32a96d0b8e5967438dcb66d9885881b9"/>
-->
        <div class="fp-prediction__container">

            <div ng-if="!ctrl.isEditingTopics"
                class="fp-prediction__most-common-view">

                <!--<img style="width:40px;height:40px;border-radius:40px;display:table;margin:0 auto 10px;" 
                    ng-show="ctrl.prediction.userEstimate.reasonText"
                    src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-xat1/v/t1.0-1/p200x200/10410095_10204571738670575_5638321658802120076_n.jpg?oh=58a86fedc0ef7299bfd8fb805ba9b044&oe=560E6791&__gda__=1444015358_32a96d0b8e5967438dcb66d9885881b9"/>-->

                <div class="fp-prediction__topics" 
                    ng-if="ctrl.areTopicsVisible"
                    ng-class="{'fp-prediction__topics--attention-grabbing':ctrl.reason}">
                    <a class="fp-prediction__topic" 
                        ui-sref="app.topic({'topic':topic.title})"
                        ng-if="topic.title != ctrl.topicToHide"
                        ng-repeat="topic in ctrl.prediction.topics">
                        {{topic.title}}
                    </a>
                </div>

                <div class="fp-prediction__title-container">
                    <a class="fp-prediction__title"
                        ng-class="{'prediction__title--flash':ctrl.isFlashPredictionTitleActive}"
                        ui-sref="app.prediction({predictionId:ctrl.prediction.id})">
                        {{::ctrl.prediction.title}}
                    </a>
                </div>

                <div class="fp-prediction__likelihood-selection">
                    <fp-user-judgement
                        current-judgement="ctrl.prediction.userEstimate"
                        prediction-id="{{ctrl.prediction.id}}"
                        on-add-reason="ctrl.onAddReason()"
                        on-already-has-reason="ctrl.setTopicsToVisible()">
                    </fp-user-judgement>
                </div>

                <span class="fp-prediction__toggle-topics-button"
                    ng-if="!ctrl.isEditingTopics"
                    ng-click="ctrl.toggleEditing()">
                    Report . Edit
                </span>
                <a class="fp-prediction__num-votes-num-reasons"
                    ui-sref="app.prediction({predictionId:ctrl.prediction.id})" 
                    ng-show="ctrl.areTopicsVisible">
                    {{ctrl.prediction.reasonsCount}} perspectives
                </a>
            </div>




            <div ng-if="ctrl.isEditingTopics"
                class="edit-prediction">

                <form class="edit-prediction__add-topics-form" >

                    <div class="edit-prediction__topics">
                        <span class="edit-prediction__topic" 
                            ng-repeat="topic in ctrl.prediction.topics">
                            {{topic.title}} 
                            <span class="edit-prediction__delete-topic" 
                                ng-click="ctrl.removeTopicFromPrediction(topic.id)">
                                Ã—
                            </span>
                        </span>
                        <span class="prediction__topic__preview-while-saving" 
                            ng-if="ctrl.topicIsSavingMessage">
                            <b>Adding</b> 
                            {{ctrl.topicIsSavingMessage}}
                        </span>
                    </div>
                    <div class="edit-prediction__prediction-title">
                        {{::ctrl.prediction.title}}
                    </div>
                   
                    <span class="prediction__topics-not-set-notice" 
                        ng-hide="ctrl.prediction.topics.length > 1">
                        This prediction appears in 
                        <b>{{ctrl.prediction.topics.length}} topics</b>. 
                        Add some relevant topics
                    </span>
                    <label ng-if="ctrl.prediction.topics.length < ctrl.maxTopicsPerPrediction"
                        class="edit-prediction__add-topics-label">
                        Add Topic
                        <input type="text" 
                        id="edit-prediction__topic-title-input" 
                        ng-model="ctrl.newTopicTitle" />
                    </label>
                    <button class="edit-prediction__add-topic-button" 
                        ng-show="ctrl.newTopicTitle.length >= 2" 
                        ng-click="ctrl.addTopicFromInputToPrediction()">
                        Add topic
                    </button>
                    <!--
                    <div class="edit-prediction__suggested-topics" 
                        ng-if="ctrl.prediction.topics.length === 0">
                        <span class="edit-prediction__suggested-topics-title">
                            Suggestions:
                        </span>
                        <ul class="edit-prediction__suggested-topics-list">
                            <li class="edit-prediction__suggested-topics-topic" 
                            ng-repeat="suggestedTopicTitle in ctrl.suggestedTopicTitles" 
                            ng-click="ctrl.addTopicFromSuggestedTopics($index)">
                            {{suggestedTopicTitle}}
                            </li>
                        </ul>
                    </div>
                    -->
                </form>


                <div class="edit-prediction__next-step-container">
                    <input type="button" 
                        class="edit-prediction__next-step-container__next-button" 
                        value="Done"  
                        ng-show="!ctrl.showDeletionConfirmation && ctrl.prediction.topics.length"
                        ng-click="ctrl.toggleEditing()"
                    />                

                    <button class="edit-prediction__report-prediction-button" 
                        ng-show="{{!ctrl.currentUserIsAuthor}}">
                        Report
                    </button>        

                    <button class="edit-prediction__delete-prediction-button" 
                        ng-show="ctrl.currentUserIsAuthor && ! ctrl.showDeletionConfirmation"
                        ng-click="ctrl.toggleShowDeletionConfirmation()">
                        Delete prediction
                    </button>
                        
                    <div class="edit-prediction_delete-prediction-confirmation" 
                        ng-show="ctrl.showDeletionConfirmation">
                        Are you sure you want to delete this prediction?
                        <button ng-click="ctrl.toggleShowDeletionConfirmation()">Cancel</button>
                        <button ng-click="ctrl.deletePrediction()">Delete</button>
                    </div>
                </div>

            </div>
        </div>


</article>


